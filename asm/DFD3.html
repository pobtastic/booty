<!DOCTYPE html>
<html>
<head>
<title>Booty: Routine at DFD3</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-wide.css" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75RERFCHBG"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-75RERFCHBG');
</script>
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="DFCB.html">DFCB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#dfd3">Map</a></td>
<td class="next">
Next: <a href="E058.html">E058</a>
</td>
</tr>
</table>
<div class="description">DFD3: All Treasure Collected</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routine at <a href="DEA8.html">InitialiseGame</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="dfd3"></span>
<div class="comments">
<div class="paragraph">
Restore the default ZX Spectrum font.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">AllTreasureCollected</td>
<td class="address-2"><span id="dfd3"></span>DFD3</td>
<td class="instruction">LD HL,$3C00</td>
<td class="comment-1" rowspan="2">Write <a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/3D00.html">3C00</a> (CHARSET-0100) to *<a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/5C36.html">CHARS</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfd6"></span>DFD6</td>
<td class="instruction">LD ($5C36),HL</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="dfd9"></span>
<div class="comments">
<div class="paragraph">
Set the attributes.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfd9"></span>DFD9</td>
<td class="instruction">LD A,$10</td>
<td class="comment-1" rowspan="4">Set INK: WHITE (07).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfdb"></span>DFDB</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfdc"></span>DFDC</td>
<td class="instruction">LD A,$07</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfde"></span>DFDE</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfdf"></span>DFDF</td>
<td class="instruction">LD A,$11</td>
<td class="comment-1" rowspan="4">Set PAPER: *<a href="5BD1.html">PaperColour</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfe1"></span>DFE1</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfe2"></span>DFE2</td>
<td class="instruction">LD A,($5BD1)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfe5"></span>DFE5</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="dfe6"></span>
<div class="comments">
<div class="paragraph">
Don't decrease *<a href="5BFF.html">TimerGoldenKey</a> every frame, we track a count of the frames and only decrease it every 20th frame.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfe6"></span>DFE6</td>
<td class="instruction">LD BC,($5BFA)</td>
<td class="comment-1" rowspan="3">Decrease *<a href="5BFA.html">TimerGoldenKey_FrameSkip</a> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfea"></span>DFEA</td>
<td class="instruction">DEC BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfeb"></span>DFEB</td>
<td class="instruction">LD ($5BFA),BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dfef"></span>DFEF</td>
<td class="instruction">LD A,B</td>
<td class="comment-1" rowspan="3">Skip to <a href="DFD3.html#e004">DisplayGoldenKeyTimer</a> if *<a href="5BFA.html">TimerGoldenKey_FrameSkip</a> is not yet zero.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dff0"></span>DFF0</td>
<td class="instruction">OR C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dff1"></span>DFF1</td>
<td class="instruction">JR NZ,<a href="DFD3.html#e004">DisplayGoldenKeyTimer</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="dff3"></span>
<div class="comments">
<div class="paragraph">
14 frames have passed, so decrease the actual timer and check that it hasn't expired yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dff3"></span>DFF3</td>
<td class="instruction">LD BC,$0014</td>
<td class="comment-1" rowspan="2">Reset *<a href="5BFA.html">TimerGoldenKey_FrameSkip</a> back to 0014.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dff6"></span>DFF6</td>
<td class="instruction">LD ($5BFA),BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dffa"></span>DFFA</td>
<td class="instruction">LD A,($5BFF)</td>
<td class="comment-1" rowspan="3">Decrease *<a href="5BFF.html">TimerGoldenKey</a> by one.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dffd"></span>DFFD</td>
<td class="instruction">DEC A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="dffe"></span>DFFE</td>
<td class="instruction">LD ($5BFF),A</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e001"></span>
<div class="comments">
<div class="paragraph">
Player lives don't matter with the Golden Key section of the game, once the timer expires it's Game Over.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e001"></span>E001</td>
<td class="instruction">JP Z,<a href="DFCB.html">ForceGameOver</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="DFCB.html">ForceGameOver</a> if *<a href="5BFF.html">TimerGoldenKey</a> is zero.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e004"></span>
<div class="comments">
<div class="paragraph">
Display the Golden Key timer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">DisplayGoldenKeyTimer</td>
<td class="address-2"><span id="e004"></span>E004</td>
<td class="instruction">LD C,$0C</td>
<td class="comment-1" rowspan="3">Set up the screen buffer location 0C/02 using <a rel="noopener nofollow" href="https://skoolkid.github.io/rom/asm/0DD9.html">CL_SET</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e006"></span>E006</td>
<td class="instruction">LD B,$02</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e008"></span>E008</td>
<td class="instruction">CALL $0DD9</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e00b"></span>
<div class="comments">
<div class="paragraph">
Store *<a href="5BFF.html">TimerGoldenKey</a> in <span class="register">BC</span> so we can use <a href="https://skoolkid.github.io/rom/asm/1A1B.html">OUT_NUM_1</a> to print it to the screen.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e00b"></span>E00B</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="3"><span class="register">BC</span>=*<a href="5BFF.html">TimerGoldenKey</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e00d"></span>E00D</td>
<td class="instruction">LD A,($5BFF)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e010"></span>E010</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e011"></span>E011</td>
<td class="instruction">CALL $1A1B</td>
<td class="comment-1" rowspan="1">Call <a href="https://skoolkid.github.io/rom/asm/1A1B.html">OUT_NUM_1</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e014"></span>
<div class="comments">
<div class="paragraph">
The ASCII space after the timer acts to clear "extra" digits when the timer transitions to being single digit.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e014"></span>E014</td>
<td class="instruction">LD A,$20</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=ASCII "space" (20).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e016"></span>E016</td>
<td class="instruction">CALL <a href="E6DC.html">PrintColourCharacter</a></td>
<td class="comment-1" rowspan="1">Call <a href="E6DC.html">PrintColourCharacter</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e019"></span>
<div class="comments">
<div class="paragraph">
Is the Golden Key in the current room?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e019"></span>E019</td>
<td class="instruction">LD A,($5BD3)</td>
<td class="comment-1" rowspan="4">Return if *<a href="5BD3.html">CurrentRoom</a> is not equal to *<a href="5BFC.html">GoldenKeyRoom</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e01c"></span>E01C</td>
<td class="instruction">LD HL,$5BFC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e01f"></span>E01F</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e020"></span>E020</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e021"></span>
<div class="comments">
<div class="paragraph">
It is in this room, so display it.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e021"></span>E021</td>
<td class="instruction">LD BC,($5BFD)</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=*<a href="5BFD.html">PositionGoldenKey</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e025"></span>E025</td>
<td class="instruction">LD HL,$DEBB</td>
<td class="comment-1" rowspan="2">Write <a href="DFBB.html">DEBB</a> (<a href="DFBB.html">Graphics_GoldenKey</a>) to *<a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/5C36.html">CHARS</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e028"></span>E028</td>
<td class="instruction">LD ($5C36),HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e02b"></span>E02B</td>
<td class="instruction">LD A,$10</td>
<td class="comment-1" rowspan="4">Set INK: YELLOW (06).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e02d"></span>E02D</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e02e"></span>E02E</td>
<td class="instruction">LD A,$06</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e030"></span>E030</td>
<td class="instruction">RST $10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e031"></span>E031</td>
<td class="instruction">LD A,$20</td>
<td class="comment-1" rowspan="1"><span class="register">A</span>=20 (base sprite ID).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e033"></span>E033</td>
<td class="instruction">LD DE,$0201</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=0201 (height/ width).</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e036"></span>E036</td>
<td class="instruction">CALL <a href="EA93.html">PrintSprite</a></td>
<td class="comment-1" rowspan="1">Call <a href="EA93.html">PrintSprite</a>.</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e039"></span>
<div class="comments">
<div class="paragraph">
Handle player collision with the Golden Key.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e039"></span>E039</td>
<td class="instruction">LD IX,$F231</td>
<td class="comment-1" rowspan="1"><span class="register">IX</span>=<a href="F231.html">TablePlayerAttributes</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e03d"></span>E03D</td>
<td class="instruction">LD BC,($5BFD)</td>
<td class="comment-1" rowspan="1"><span class="register">BC</span>=*<a href="5BFD.html">PositionGoldenKey</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e041"></span>E041</td>
<td class="instruction">LD A,(IX+$00)</td>
<td class="comment-1" rowspan="3">Return if the players horizontal co-ordinate is not equal to the Golden Key horizontal co-ordinate.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e044"></span>E044</td>
<td class="instruction">CP C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e045"></span>E045</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e046"></span>E046</td>
<td class="instruction">LD A,(IX+$01)</td>
<td class="comment-1" rowspan="3">Return if the players vertical co-ordinate is not equal to the Golden Key vertical co-ordinate.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e049"></span>E049</td>
<td class="instruction">CP B</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e04a"></span>E04A</td>
<td class="instruction">RET NZ</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="e04b"></span>
<div class="comments">
<div class="paragraph">
The player has collected the Golden Key!
</div>
<div class="paragraph">
Hilariously, just beep at the player and restart the game. Zero fanfare!
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e04b"></span>E04B</td>
<td class="instruction">LD DE,$00C8</td>
<td class="comment-1" rowspan="1"><span class="register">DE</span>=00C8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e04e"></span>E04E</td>
<td class="instruction">LD HL,$00C8</td>
<td class="comment-1" rowspan="1"><span class="register">HL</span>=00C8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e051"></span>E051</td>
<td class="instruction">CALL $03B5</td>
<td class="comment-1" rowspan="1">Call <a rel="noopener nofollow" href="https://skoolkit.ca/disassemblies/rom/hex/asm/03B5.html">BEEPER</a>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e054"></span>E054</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore <span class="register">BC</span> from the stack.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="e055"></span>E055</td>
<td class="instruction">JP <a href="DEA8.html#debc">InitialiseGameStates</a></td>
<td class="comment-1" rowspan="1">Jump to <a href="DEA8.html#debc">InitialiseGameStates</a>.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="DFCB.html">DFCB</a>
</td>
<td class="up">Up: <a href="../maps/all.html#dfd3">Map</a></td>
<td class="next">
Next: <a href="E058.html">E058</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1984 Firebird &copy; 2024 ArcadeGeek LTD.</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.1.</div>
<div class="repository">Link to <a href="https://github.com/pobtastic/booty/">Source code</a>.</div>
<div><a href="asm/DFD3.html">Switch to decimal</a>.</div>
</footer>
</body>
</html>